# Reflow란

브라우저 렌더링 과정의 핵심. 액션이나 이벤트에 의해 요소에 변화가 생기면 Layout (Reflow) 단계를 다시 수행하게 된다. 레이아웃을 재계산하는 상황이라고 할 수 있다. 연산이 필요하기 때문에 브라우저 퍼포먼스에 영향을 준다. Reflow가 발생하면 변경된 렌더 트리가 화면에 그려지는 과정 즉 Repaint가 필연적으로 발생한다.

→ 브라우저 퍼포먼스에 영향을 주기 때문에 Reflow가 자주 발생하는 코드는 지양해야 한다. 최소한으로 발생하는 방법을 택하자.

# Reflow가 발생하는 경우

DOM의 변경이 있는 경우

1. 요소의 크기, 위치 변겅
2. 브라우저 창의 크기 변경
3. font size 변경
4. scroll
5. DOM API를 통한 노드 요소의 추가, 삭제

# Reflow를 최소화하는 방법

1. DOM 트리의 Depth를 최소화한다.
   - DOM 트리의 Depth가 얕을수록 Relfow가 발생했을 때 비용을 절감할 수 있다. 영향을 받는 요소들이 적어지기 때문에 소비되는 연산이 줄어든다.
2. JS를 통해 스타일 변화를 주어야 할 경우 가급적 한 번에 처리한다. 요소에 한 번만 접근하여 스타일을 변경하는 것이 낫다.

```jsx
// Bad
e.target.style.width = "150px";
e.target.style.height = "120px";

// Good
e.target.style = "width: 150px; height: 120px;";
```

3. 가급적 레이아웃 피하기
   - [Reflow를 발생시키는 CSS 트리거](https://csstriggers.com/)
   - width, height 등과 같은 기하학적 속성의 변경은 변경되는 요소 외에 다른 요소들이 많이 존재한다면, 모든 요소들의 위치와 크기를 계산하는데 많은 시간이 걸린다. 꼭 필요한 경우가 아니라면 피하자.
     - 불가피하게 사용해야 한다면 tranform을 사용하고, visibility, display보다는 opacity를 사용하자.
4. flexbox 사용
   - float과 같은 이전 레이아웃 모델은 Reflow 시간이 훨씬 오래 걸린다.
     - IE를 고려해야 한다면 사용할 수 없다.
5. 애니메이션은 흐름 밖에서 변경한다.
   - 애니메이션 같이 복잡한 렌더링 변경이 필요한 경우에는 HTML 요소들의 흐름 밖에서 변경한다. position을 절대 위치(absolute) 또는 고정 위치(fixed)를 사용하여 주변 요소들에 영향을 주지 않도록 해야 한다.
6. CSS 하위 선택자는 필요한 만큼한 정리
   - CSS Rule 매칭은 우측에서 좌측으로 흐른다. CSS Rule이 적다면 Reflow는 더 빠르게 진행된다. 필요 이상의 Rule을 지정하지 말자.
